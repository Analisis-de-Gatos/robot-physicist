name: Quarto Publish (F√≠sico Remoto CI/CD)

on:
  # Se ejecuta con cada 'push' a la rama principal
  push:
    branches: [main]
  # Permite la ejecuci√≥n manual desde la interfaz de GitHub Actions
  workflow_dispatch:

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    # Permisos necesarios para que la Action pueda descargar y publicar en GitHub Pages
    permissions:
      contents: write 
      pages: write    
      id-token: write 

    steps:
      - name: ‚¨áÔ∏è Checkout del Repositorio
        uses: actions/checkout@v4

      # --- PASO 1: Configuraci√≥n del Entorno (Quarto y Python) ---
      # Usamos 'latest' para mayor flexibilidad, asegurando que Quarto est√© instalado.
      - name: üõ†Ô∏è Configurar Quarto y Python
        uses: quarto-dev/quarto-actions/setup@v2
        with:
          version: 'latest' # Usar 'latest' para evitar fallos por versiones espec√≠ficas
          python-version: '3.11' 

      - name: üì¶ Instalar dependencias de Python (uproot, marimo, hist, etc.)
        # Se asume que requirements.txt est√° en la ra√≠z del repositorio
        run: |
          pip install -r requirements.txt

      # üîç Opcional: Verificar que las dependencias principales est√©n instaladas
      - name: Verificar Instalaci√≥n
        run: |
          python -c "import uproot; print('uproot instalado')"
          python -c "import marimo; print('marimo instalado')"

      # --- PASO 2: Descarga de Datos (Tu c√≥digo de an√°lisis puede hacer esto) ---
      # Mantener este paso como recordatorio o para ejecutar scripts auxiliares de descarga
      - name: üì• (Opcional) Script de Descarga de Datos
        run: echo "El c√≥digo de an√°lisis en Quarto manejar√° la descarga y lectura."
          
      # --- PASO 3: An√°lisis y Renderizado Quarto ---
      - name: ‚öôÔ∏è Ejecutar An√°lisis y Renderizado del Sitio Quarto
        # Navega al subdirectorio donde se encuentra el proyecto Quarto (con _quarto.yml)
        run: |
          cd robot-physicist-website
          quarto render

      # --- PASO 4: Despliegue a GitHub Pages ---
      # Las acciones de despliegue son correctas y usan la ruta del sitio compilado
      - name: ‚öôÔ∏è Configurar GitHub Pages
        uses: actions/configure-pages@v4
        with:
          # La carpeta de salida es 'robot-physicist-website/_site'
          static_site_root: 'robot-physicist-website/_site' 
          
      - name: üöÄ Subir artefacto para Pages
        uses: actions/upload-pages-artifact@v3
        with:
          path: 'robot-physicist-website/_site' 

      - name: üåê Desplegar a GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4

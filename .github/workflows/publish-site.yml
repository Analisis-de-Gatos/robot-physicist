name: Quarto Publish (Físico Remoto CI/CD)

on:
  push:
    branches: ["main"]
  workflow_dispatch:

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    permissions:
      contents: write
      pages: write
      id-token: write

    steps:
      # Paso 1: Checkout del código fuente
      - name: Checkout del Repositorio
        uses: actions/checkout@v4
        # Permite acceder y trabajar con el código del repositorio

      # Paso 2: Instalar Quarto y configurar Python
      - name: Configurar Quarto y Python
        uses: quarto-dev/quarto-actions/setup@v2
        with:
          version: latest
          python-version: 3.11
        # Instala Quarto y configura Python 3.11 para mayor compatibilidad

      # Paso 3: Instalar dependencias
      - name: Instalar dependencias
        run: pip install -r requirements.txt
        # Instala todas las librerías necesarias desde requirements.txt

      # Paso 4: Instalar extensión Quarto marimo
      - name: Instalar extensión Quarto marimo
        run: |
          quarto install
          quarto add marimo-team/quarto-marimo
        # Instala Quarto y la extensión marimo para notebooks interactivos

      # Paso 5: Renderizar sitio Quarto
      - name: Renderizar sitio Quarto
        run: cd robot-physicist-website && quarto render
        # Genera automáticamente los HTML en la carpeta correcta

      # Paso 6: Validar archivos generados y el build
      - name: Validar generación de HTML
        run: |
          if ls robot-physicist-website/site/*.html; then
            echo "Archivos HTML generados correctamente."
          else
            echo "ERROR: No se generaron los archivos HTML." && exit 1
          fi
        # Verifica que los archivos HTML existen en la carpeta de salida

      # Paso 7: Subir y desplegar artefactos
      - name: Subir artefactos a GitHub Pages
        uses: actions/upload-pages-artifact@v3
        with:
          path: robot-physicist-website/site
        # Sube los archivos generados para su publicación

      - name: Desplegar a GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
        # Publica el sitio en GitHub Pages

